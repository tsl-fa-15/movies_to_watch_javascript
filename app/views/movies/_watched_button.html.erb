<% watchlist_item = WatchlistItem.where(movie_id: movie.id, user_id: current_user.id).first %>
<% if watchlist_item %>
  <% if watchlist_item.watched == true %>
    <%= link_to unwatch_watchlist_item_path(watchlist_item), method: :patch, remote: true, id: "mark_movie_#{movie.id}_unwatched", class: 'btn btn-warning movie-panel-button' do %>
      <i class="fa fa-times"></i> Mark as unwatched
    <% end %>
  <% else %>
    <%= render 'movies/mark_as_watched_button', movie: movie %>
  <% end %>
<% else %>
  <%= render 'movies/mark_as_watched_button', movie: movie %>
<% end %>
